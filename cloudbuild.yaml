steps:
  # Install dependencies with legacy peer deps flag
  - name: 'node:20'
    entrypoint: 'npm'
    args: ['ci', '--legacy-peer-deps']
  
  # Build the TypeScript application
  - name: 'node:20'
    entrypoint: 'npm'
    args: ['run', 'build']
  
  # Deploy to Cloud Run
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['run', 'deploy', 'omen-backend', '--source', '.', '--platform', 'managed', '--region', 'us-central1', '--allow-unauthenticated']

# Configure build options
options:
  logging: CLOUD_LOGGING_ONLY
  machineType: 'E2_HIGHCPU_8'
